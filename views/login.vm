##
## Velocity Template for DisplayUsernamePasswordPage view-state
##
## Velocity context will contain the following properties
## flowExecutionUrl - the form action location
## flowRequestContext - the Spring Web Flow RequestContext
## flowExecutionKey - the SWF execution key (this is built into the flowExecutionUrl)
## profileRequestContext - root of context tree
## authenticationContext - context with authentication request information
## authenticationErrorContext - context with login error state
## authenticationWarningContext - context with login warning state
## ldapResponseContext - context with LDAP state (if using native LDAP)
## rpUIContext - the context with SP UI information from the metadata
## encoder - HTMLEncoder class
## request - HttpServletRequest
## response - HttpServletResponse
## environment - Spring Environment object for property resolution
## custom - arbitrary object injected by deployer
##
#set ($rpContext = $profileRequestContext.getSubcontext('net.shibboleth.idp.profile.context.RelyingPartyContext'))
#set ($username = $authenticationContext.getSubcontext('net.shibboleth.idp.authn.context.UsernamePasswordContext', true).getUsername())
##

#parse ("header.vm")

<main class="d-flex flex-md-row flex-column container-fluid justify-content-center" style="margin-top: 64px" id="content">

    <div class="d-flex flex-column col-lg-7 mt-5">
        <div class="card">
        <div class="card-body">

            #set ($serviceName = $rpUIContext.serviceName)
            #if ($serviceName && !$rpContext.getRelyingPartyId().contains($serviceName))
            <h5 class="card-title mb-4">#springMessageText("idp.login.loginTo", "Login to") $encoder.encodeForHTML($serviceName)</h5>
            #end

            #*
            //
            //    SP Description & Logo (optional)
            //    These idpui lines will display added information (if available
            //    in the metadata) about the Service Provider (SP) that requested
            //    authentication. These idpui lines are "active" in this example
            //    (not commented out) - this extra SP info will be displayed.
            //    Remove or comment out these lines to stop the display of the
            //    added SP information.
            //
            *#
            #set ($logo = $rpUIContext.getLogo())
            #if ($logo)
            <img class="service-logo" src= "$encoder.encodeForHTMLAttribute($logo)" alt="$encoder.encodeForHTMLAttribute($serviceName)" />
            #end
            #set ($desc = $rpUIContext.getServiceDescription())
            #if ($desc)
            <p class="card-text">$encoder.encodeForHTML($desc)</p>
            #end


            <section>
            <form action="$flowExecutionUrl" method="post">
                    #parse("csrf/csrf.vm")

                    #parse("login-error.vm")
                <div class="form-outline mt-4 mb-4">
                    <input class="form-control" id="username" name="j_username" type="text"
                           value="#if($username)$encoder.encodeForHTML($username)#end" />
                    <label class="form-label" for="username">#springMessageText("idp.login.username", "Username")</label>
                </div>
                        
                <div class="form-outline mb-4">
                    <input class="form-control" type="password" name="j_password" id="password" value="" />
                    <label class="form-label" for="password">#springMessageText("idp.login.password", "Password")</label>
                </div>

                ## You may need to modify this to taste, such as changing the flow name checked to authn/MFA.
                #if (!$authenticationContext.getActiveResults().containsKey('authn/Password'))
                <div class="form-check mb-4">
                    <input class="form-check-input" type="checkbox" name="donotcache" value="1" id="donotcache" />
                    <label class="form-check-label" for="donotcache">#springMessageText("idp.login.donotcache", "Don't Remember Login")</label>
                </div>
                #end

                <div class="form-check mb-4">
                    <input class="form-check-input" id="_shib_idp_revokeConsent" type="checkbox" name="_shib_idp_revokeConsent" value="true" />
                    <label class="form-check-label" for="_shib_idp_revokeConsent">#springMessageText("idp.attribute-release.revoke", "Clear prior granting of permission for release of your information to this service.")</label>
                </div>

                <div class="grid">
                    <div class="grid-item">
                        <button class="btn btn-primary" type="submit" name="_eventId_proceed"
                                onClick="this.childNodes[0].nodeValue='#springMessageText('idp.login.pleasewait', 'Logging in, please wait...')'">
                        #springMessageText("idp.login.login", "Login")
                        </button>
                    </div>
                </div>
            </form>
    
            </section>
        </div>
        </div>
    </div>
</main>

#parse ("footer.vm")